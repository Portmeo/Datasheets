import{a as Z,g as ee,s as ae,_ as T,r as S,u as ne,e as te,j as n,h as se,k as oe,an as ie,G as K,J as re,D as le,i as u,z as h,T as N,C as s,I as Y}from"./index.5e305b55.js";import{D as A,i as ce,M as me,T as pe}from"./datasheet.service.562f1265.js";import{C as de}from"./category.service.3d87575e.js";import{F as m,T as g,I as ue,S as he,O as ge}from"./TextField.edf9f7ab.js";import{B as X}from"./requestHandler.service.2acc9590.js";import"./Tooltip.8dae43f7.js";function Ce(a){return Z("MuiCardMedia",a)}ee("MuiCardMedia",["root","media","img"]);const ve=["children","className","component","image","src","style"],xe=a=>{const{classes:C,isMediaComponent:p,isImageComponent:v}=a;return oe({root:["root",p&&"media",v&&"img"]},Ce,C)},fe=ae("div",{name:"MuiCardMedia",slot:"Root",overridesResolver:(a,C)=>{const{ownerState:p}=a,{isMediaComponent:v,isImageComponent:y}=p;return[C.root,v&&C.media,y&&C.img]}})(({ownerState:a})=>T({display:"block",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"},a.isMediaComponent&&{width:"100%"},a.isImageComponent&&{objectFit:"cover"})),we=["video","audio","picture","iframe","img"],ye=["picture","img"],Me=S.exports.forwardRef(function(C,p){const v=ne({props:C,name:"MuiCardMedia"}),{children:y,className:x,component:f="div",image:e,src:w,style:E}=v,b=te(v,ve),l=we.indexOf(f)!==-1,I=!l&&e?T({backgroundImage:`url("${e}")`},E):E,d=T({},v,{component:f,isMediaComponent:l,isImageComponent:ye.indexOf(f)!==-1}),M=xe(d);return n(fe,T({className:se(M.root,x),as:f,role:!l&&e?"img":void 0,ref:p,style:I,ownerState:d,src:l?e||w:void 0},b,{children:y}))}),Se=Me,Ee=()=>{const{id:a}=ie(),[C,p]=S.exports.useState(),[v,y]=S.exports.useState([]),[x,f]=S.exports.useState([]),[e,w]=S.exports.useState({name:"",value:0}),E=async()=>{const c=await de.getAll();c&&y(c)},b=async c=>{const i=await A.get(c);i&&(p(i),f(i.categories.map(D=>D._id)))},l=()=>{p({expenses:0,weight:0,workmanship:[{name:"Fundicion",value:0},{name:"Repasado",value:0},{name:"Plateado",value:0},{name:"Tallado",value:0}],metals:{silver:{price:0},gold:{price:0}}})},I=async c=>{await A.create(k(c))&&(p(void 0),f([]),w({name:"",value:0}),M(),l())},d=async c=>{await A.update(k(c))&&M()},M=()=>{K.proccesSuccess()},k=c=>{const i=JSON.parse(JSON.stringify(c));return i.metals.silver.price=+i.metals.silver.price,i.metals.gold&&(i.metals.gold.price=+c.metals.gold.price),i.workmanship.forEach(D=>{D.value=+D.value}),i};return S.exports.useEffect(()=>{E(),a&&a!=="new"&&b(a),a&&a==="new"&&l()},[]),S.exports.useEffect(()=>()=>{K.reset()},[]),{categoryOptions:v,categorySelect:x,setCategorySelect:f,workmanship:e,setWorkmanship:w,datasheet:C,setDatasheet:p,createDatasheet:I,updateDatasheet:d,id:a}};const De=a=>a?a.charAt(0).toUpperCase()+a.slice(1):"",be="https://api-datasheets.vercel.app/api",Ie=48,ke=8,Ne={PaperProps:{style:{maxHeight:Ie*4.5+ke,width:250}}},Re=()=>{var P,z,W,R,U,G,_,F,L,j,B,H,$,J,V;const{t:a}=re(),C=le(),{categoryOptions:p,categorySelect:v,setCategorySelect:y,workmanship:x,setWorkmanship:f,datasheet:e,setDatasheet:w,createDatasheet:E,updateDatasheet:b,id:l}=Ee(),I=e!=null&&e.image?`${be}/proxy?url=${encodeURIComponent(e.image)}`:ce,d=t=>o=>{const r={...e&&{...e},[t]:o.target.value};w(r)},M=t=>o=>{const[r,O]=t.split("."),Q={...e,metals:{...e.metals,[r]:{[O]:o.target.value}}};w(Q)},k=t=>{const{target:{value:o}}=t,r={...e,categories:o};w(r),y(typeof o=="string"?o.split(","):o)},c=t=>{const o={...e,workmanship:e.workmanship.filter(r=>r.name!==t)};w(o)},i=t=>o=>{const r={...x,[t]:t==="value"?o.target.value:De(o.target.value.toLowerCase())};f(r)},D=t=>o=>{const r=e.workmanship;r[t].value=o.target.value;const O={...e,workmanship:r};w(O)},q=()=>{const t=e.workmanship?[...e.workmanship,x]:[x],o={...e,workmanship:t};f({name:"",value:0}),w(o)};return u(h,{children:[u(h,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",sx:{gap:2,flexDirection:{xs:"column",md:"row",lg:"row"}},children:[u(h,{display:"flex",sx:{mt:1,flexDirection:"column",alignItems:"center"},children:[n(N,{variant:"h6",component:"div",sx:{flexGrow:1,color:"#1976D2",mb:2},children:a(s.IMAGE)}),n(Se,{sx:{width:300,height:300},component:"img",image:I,alt:"img"}),n(m,{fullWidth:!0,margin:"normal",children:n(g,{size:"small",label:a(s.IMAGE),value:(P=e==null?void 0:e.image)!=null?P:"",onChange:d("image")})})]}),u(h,{sx:{mt:1,width:{xs:"100%",md:"30%",lg:"30%"}},children:[n(N,{variant:"h6",component:"div",sx:{flexGrow:1,color:"#1976D2"},children:a(s.DATA)}),n(m,{fullWidth:!0,margin:"normal",children:n(g,{size:"small",label:a(s.CODE),value:(z=e==null?void 0:e.code)!=null?z:"",onChange:d("code")})}),n(m,{fullWidth:!0,margin:"normal",children:n(g,{size:"small",label:a(s.NAME),value:(W=e==null?void 0:e.name)!=null?W:"",onChange:d("name")})}),n(m,{fullWidth:!0,margin:"normal",children:n(g,{size:"small",label:a(s.MODEL),value:(R=e==null?void 0:e.model)!=null?R:"",onChange:d("model")})}),n(m,{fullWidth:!0,margin:"normal",children:n(g,{size:"small",label:a(s.DESCRIPTION),value:(U=e==null?void 0:e.description)!=null?U:"",onChange:d("description")})}),u(m,{fullWidth:!0,margin:"normal",children:[n(ue,{size:"small",id:"category-label",children:a(s.CATEGORY)}),n(he,{size:"small",labelId:"category-label",id:"category",multiple:!0,value:v,onChange:k,input:n(ge,{label:a(s.CATEGORY)}),MenuProps:Ne,children:p.map(t=>n(me,{value:t._id,children:t.name.toUpperCase()},t._id))})]}),n(m,{sx:{width:"49%",mr:"1%"},margin:"normal",children:n(g,{size:"small",label:a(s.EXPENSES),inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:(G=e==null?void 0:e.expenses)!=null?G:"",onChange:d("expenses")})}),n(m,{sx:{width:"49%",ml:"1%"},margin:"normal",children:n(g,{size:"small",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},label:a(s.WEIGHT),value:(_=e==null?void 0:e.weight)!=null?_:"",onChange:d("weight")})}),n(m,{sx:{width:"49%",mr:"1%"},margin:"normal",children:n(g,{size:"small",label:a(s.SILVER),inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:(j=(L=(F=e==null?void 0:e.metals)==null?void 0:F.silver)==null?void 0:L.price)!=null?j:"",onChange:M("silver.price")})}),n(m,{sx:{width:"49%",ml:"1%"},margin:"normal",children:n(g,{size:"small",label:a(s.GOLD),inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:($=(H=(B=e==null?void 0:e.metals)==null?void 0:B.gold)==null?void 0:H.price)!=null?$:"",onChange:M("gold.price")})})]}),u(h,{sx:{mt:1,width:{xs:"100%",md:"35%",lg:"35%"}},children:[n(N,{variant:"h6",component:"div",sx:{flexGrow:1,color:"#1976D2"},children:a(s.WORKMANSHIPS)}),u(h,{display:"flex",justifyContent:"space-between",children:[u(h,{display:"flex",justifyContent:"space-between",sx:{width:"90%"},children:[n(m,{sx:{width:"49%"},margin:"normal",children:n(g,{size:"small",label:a(s.NAME),value:x.name,onChange:i("name")})}),n(m,{sx:{width:"49%"},margin:"normal",size:"small",children:n(g,{size:"small",label:a(s.VALUE),inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:(J=x.value)!=null?J:"",onChange:i("value")})})]}),n(Y,{disabled:!x.name||!x.value,sx:{width:"10%"},onClick:q,children:s.ICONS.ADD})]}),(V=e==null?void 0:e.workmanship)==null?void 0:V.map((t,o)=>{var r;return u(h,{display:"flex","align-item":"center",children:[u(h,{className:"row",children:[n(h,{className:"column",children:t.name}),n(m,{className:"value",margin:"normal",size:"small",children:n(g,{size:"small",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:(r=t.value)!=null?r:"",onChange:D(o)})})]}),n(Y,{className:"delete",sx:{padding:0,mb:"10px",width:"10%"},onClick:()=>c(t.name),children:s.ICONS.DELETE},t.name)]},t.name)})]}),u(h,{sx:{mt:1,width:{xs:"100%",md:"25%",lg:"25%"}},children:[n(N,{variant:"h6",component:"div",sx:{flexGrow:1,color:"#1976D2",mb:2},children:a(s.RESULT)}),n(pe,{datasheet:e})]})]}),u(h,{display:"flex",justifyContent:"space-between",children:[n(X,{sx:{mt:1},variant:"outlined",onClick:()=>C("/datasheet"),children:a(s.BACK)}),n(X,{disabled:!e,sx:{mt:1},variant:"contained",onClick:()=>(l==null?void 0:l.toUpperCase())===s.NEW.toUpperCase()?E(e):b(e),children:(l==null?void 0:l.toUpperCase())===s.NEW.toUpperCase()?a(s.CREATE):a(s.EDIT)})]})]})};export{Re as DatasheetForm};
